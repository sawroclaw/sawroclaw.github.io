/*! For license information please see 7310b475821cb77cf612.js.LICENSE.txt */
function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return _regeneratorDefine2(l,"_invoke",function(n,r,o){var a,s,c,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,i}};function m(n,r){for(s=n,c=r,t=0;!u&&l&&!o&&t<d.length;t++){var o,a=d[t],m=p.p,f=a[2];n>3?(o=f===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(s=0,p.v=r,p.n=a[1]):m<f&&(o=n<3||a[0]>r||r>f)&&(a[4]=n,a[5]=r,p.n=f,s=0))}if(o||n>1)return i;throw u=!0,r}return function(o,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),s=d,c=f;(t=s<2?e:c)||!u;){a||(s?s<3?(s>1&&(p.n=-1),m(s,c)):p.n=c:p.v=c);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(u=p.n<0)?c:n.call(r,p))!==i)break}catch(t){a=e,s=1,c=t}finally{l=1}}return{value:t,done:u}}}(n,o,a),!0),l}var i={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),u=l.prototype=s.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return c.prototype=l,_regeneratorDefine2(u,"constructor",l),_regeneratorDefine2(l,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(l,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,r,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:p}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,t,n,r){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){asyncGeneratorStep(a,r,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,r,o,i,s,"throw",e)}i(void 0)})}}var isSending=!1;function sendPhishingReport(){return _sendPhishingReport.apply(this,arguments)}function _sendPhishingReport(){return _sendPhishingReport=_asyncToGenerator(_regenerator().m(function e(){var t,n,r,o,a,i,s,c,l,d,u,p,m;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(p=function(e,t){var n=document.getElementById("phish-status");n&&(n.textContent=e,n.style.color=t?"#b00020":"#2b7a0b")},!isSending){e.n=1;break}return console.warn("Już trwa wysyłanie — pomijam kolejne wywołanie"),e.a(2);case 1:if(isSending=!0,e.p=2,t=function(e){return new Promise(function(t,n){Office.context.mailbox.makeEwsRequestAsync(e,function(e){e.status===Office.AsyncResultStatus.Succeeded?t(e.value):n(e.error||e)})})},n=function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,o,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r='<?xml version="1.0" encoding="utf-8"?>\n        <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                       xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages"\n                       xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types"\n                       xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">\n          <soap:Header>\n            <t:RequestServerVersion Version="Exchange2016" />\n          </soap:Header>\n          <soap:Body>\n            <m:GetItem>\n              <m:ItemShape>\n                <t:BaseShape>IdOnly</t:BaseShape>\n                <t:IncludeMimeContent>true</t:IncludeMimeContent>\n              </m:ItemShape>\n              <m:ItemIds>\n                <t:ItemId Id="'.concat(escapeXml(n),'" />\n              </m:ItemIds>\n            </m:GetItem>\n          </soap:Body>\n        </soap:Envelope>'),e.n=1,t(r);case 1:if(o=e.v,(a=o.match(/<\w*:MimeContent[^>]*>([\s\S]*?)<\/\w*:MimeContent>/i))&&a[1]){e.n=2;break}throw new Error("MimeContent nie znaleziono w odpowiedzi EWS.");case 2:return e.a(2,a[1].trim())}},e)}));return function(t){return e.apply(this,arguments)}}(),r=function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r='<?xml version="1.0" encoding="utf-8"?>\n        <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                       xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages"\n                       xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types"\n                       xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">\n          <soap:Header>\n            <t:RequestServerVersion Version="Exchange2016" />\n          </soap:Header>\n          <soap:Body>\n            <m:CreateItem MessageDisposition="SendAndSaveCopy">\n              <m:SavedItemFolderId>\n                <t:DistinguishedFolderId Id="sentitems" />\n              </m:SavedItemFolderId>\n              <m:Items>\n                <t:Message>\n                  <t:Subject>'.concat(escapeXml(c),'</t:Subject>\n                  <t:Body BodyType="HTML">').concat(escapeXml(l),"</t:Body>\n                  <t:ToRecipients>\n                    <t:Mailbox>\n                      <t:EmailAddress>").concat(o,"</t:EmailAddress>\n                    </t:Mailbox>\n                  </t:ToRecipients>\n                  <t:Attachments>\n                    <t:FileAttachment>\n                      <t:Name>SuspectedMessage.eml</t:Name>\n                      <t:ContentType>message/rfc822</t:ContentType>\n                      <t:Content>").concat(n,"</t:Content>\n                    </t:FileAttachment>\n                  </t:Attachments>\n                </t:Message>\n              </m:Items>\n            </m:CreateItem>\n          </soap:Body>\n        </soap:Envelope>"),e.n=1,t(r);case 1:return a=e.v,e.a(2,a)}},e)}));return function(t){return e.apply(this,arguments)}}(),o="soc@wroclaw.sa.gov.pl",(a=Office.context.mailbox.item)&&a.itemId){e.n=3;break}return p("Brak aktywnej wiadomości.",!0),e.a(2);case 3:i=[{id:"opt-answered",text:"Odpowiedziano na e-mail."},{id:"opt-downloaded",text:"Pobrano plik."},{id:"opt-opened",text:"Otworzono załącznik."},{id:"opt-visited",text:"Odwiedzono link."},{id:"opt-password",text:"Wprowadzono swoje hasło."},{id:"opt-forwarded",text:"Przesłano dalej ten e-mail."},{id:"opt-none",text:"Nie zrobiono nic z e-mailem."}].filter(function(e){var t;return null===(t=document.getElementById(e.id))||void 0===t?void 0:t.checked}).map(function(e){return e.text}),s=i.length?"<ul>".concat(i.map(function(e){return"<li>".concat(escapeXml(e),"</li>")}).join(""),"</ul>"):"<p>Brak zaznaczonych opcji.</p>",c="Zgłoszenie phishing — ".concat(a.subject||""),l="<p>Użytkownik zgłosił podejrzaną wiadomość. Wybrane opcje:</p>".concat(s,"<hr/><p>Oryginalny temat: ").concat(escapeXml(a.subject||"(brak)"),"</p>"),d=a.itemId;try{Office.context.mailbox.convertToEwsId&&(d=Office.context.mailbox.convertToEwsId(a.itemId))}catch(e){}return p("Wysyłanie zgłoszenia...",!1),e.n=4,n(d);case 4:return u=e.v,e.n=5,r(u);case 5:showResult(!0,"Dziękujemy — zgłoszenie zostało wysłane.","Twoje zgłoszenie zostało przekazane zespołowi ds. bezpieczeństwa."),e.n=7;break;case 6:e.p=6,m=e.v,console.error("EWS error:",m),showResult(!1,"Błąd wysyłania zgłoszenia","Wystąpił błąd: "+escapeXml(m&&m.message?m.message:JSON.stringify(m)));case 7:return e.p=7,isSending=!1,e.f(7);case 8:return e.a(2)}},e,null,[[2,6,7,8]])})),_sendPhishingReport.apply(this,arguments)}function showResult(e,t,n){var r=document.getElementById("result-title"),o=document.getElementById("result-message"),a=document.getElementById("result-icon"),i=document.getElementById("result-again");r&&(r.textContent=t,r.style.textAlign="center"),o&&(o.innerHTML=n),a&&(a.innerHTML=e?'<svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true"><circle cx="32" cy="32" r="32" fill="#c6f6e9"/><circle cx="32" cy="32" r="22" fill="#a8efd0"/><path d="M20 34 L28 42 L44 24" stroke="#065f3a" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>':'<svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true"><circle cx="32" cy="32" r="32" fill="#ffd9d9"/><circle cx="32" cy="32" r="22" fill="#ffd0d0"/><path d="M22 22 L42 42 M42 22 L22 42" stroke="#a11a1a" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>'),i&&i.classList.toggle("hidden",e),["panel-select","panel-report","panel-result"].forEach(function(e){var t=document.getElementById(e);if(t)if("panel-result"===e)t.classList.remove("hidden"),requestAnimationFrame(function(){return t.classList.add("active")});else{t.classList.remove("active");var n=function(e){"opacity"!==e.propertyName&&"transform"!==e.propertyName||(t.classList.add("hidden"),t.removeEventListener("transitionend",n))};t.addEventListener("transitionend",n)}})}function escapeXml(e){return e?e.replace(/[<>&'"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"}[e]}):""}Office.onReady(function(e){try{if(e.host===Office.HostType.Outlook){var t=function(e){["panel-select","panel-report","panel-result"].forEach(function(t){var n=document.getElementById(t);if(n)if(t===e)n.classList.remove("hidden"),requestAnimationFrame(function(){return n.classList.add("active")});else{n.classList.remove("active");var r=function(e){"opacity"!==e.propertyName&&"transform"!==e.propertyName||(n.classList.add("hidden"),n.removeEventListener("transitionend",r))};n.addEventListener("transitionend",r)}})},n=document.getElementById("app-body");n&&(n.style.display="block");var r=Office.context.mailbox.item,o=document.getElementById("item-subject");o&&(o.textContent=r&&r.subject?r.subject:"(brak tematu)");var a=document.getElementById("runSendPost"),i=document.getElementById("report-phish"),s=document.getElementById("btn-back"),c=document.getElementById("result-close"),l=document.getElementById("result-again");a&&(a.addEventListener("click",function(){return t("panel-report")}),a.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t("panel-report"))})),i&&i.addEventListener("click",function(){i.disabled=!0,sendPhishingReport().finally(function(){i.disabled=!1})}),s&&s.addEventListener("click",function(){return t("panel-select")}),c&&c.addEventListener("click",function(){return t("panel-select")}),l&&l.addEventListener("click",function(){t("panel-report"),document.querySelectorAll("#panel-report input[type='checkbox']").forEach(function(e){return e.checked=!1});var e=document.getElementById("phish-status");e&&(e.textContent="")}),t("panel-select")}}catch(e){console.error("Office.onReady handler error:",e)}});