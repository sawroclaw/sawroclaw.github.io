/*! For license information please see 07cbe319caa5440425d3.js.LICENSE.txt */
function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,o,r,a){var i=o&&o.prototype instanceof s?o:s,u=Object.create(i.prototype);return _regeneratorDefine2(u,"_invoke",function(n,o,r){var a,s,i,u=0,l=r||[],d=!1,m={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,i=e,m.n=n,c}};function p(n,o){for(s=n,i=o,t=0;!d&&u&&!r&&t<l.length;t++){var r,a=l[t],p=m.p,f=a[2];n>3?(r=f===o)&&(i=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((r=n<2&&p<a[1])?(s=0,m.v=o,m.n=a[1]):p<f&&(r=n<3||a[0]>o||o>f)&&(a[4]=n,a[5]=o,m.n=f,s=0))}if(r||n>1)return c;throw d=!0,o}return function(r,l,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,f),s=l,i=f;(t=s<2?e:i)||!d;){a||(s?s<3?(s>1&&(m.n=-1),p(s,i)):m.n=i:m.v=i);try{if(u=2,a){if(s||(r="next"),t=a[r]){if(!(t=t.call(a,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),s=1);a=e}else if((t=(d=m.n<0)?i:n.call(o,m))!==c)break}catch(t){a=e,s=1,i=t}finally{u=1}}return{value:t,done:d}}}(n,r,a),!0),u}var c={};function s(){}function i(){}function u(){}t=Object.getPrototypeOf;var l=[][o]?t(t([][o]())):(_regeneratorDefine2(t={},o,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(d),e}return i.prototype=u,_regeneratorDefine2(d,"constructor",u),_regeneratorDefine2(u,"constructor",i),i.displayName="GeneratorFunction",_regeneratorDefine2(u,r,"GeneratorFunction"),_regeneratorDefine2(d),_regeneratorDefine2(d,r,"Generator"),_regeneratorDefine2(d,o,function(){return this}),_regeneratorDefine2(d,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:m}})()}function _regeneratorDefine2(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}_regeneratorDefine2=function(e,t,n,o){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,r,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(o,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(o,r){var a=e.apply(t,n);function c(e){asyncGeneratorStep(a,o,r,c,s,"next",e)}function s(e){asyncGeneratorStep(a,o,r,c,s,"throw",e)}c(void 0)})}}function sendPhishingReport(){var e=Office.context.mailbox.item;if(document.getElementById("phish-status"),e&&e.itemId){var t=[{id:"opt-answered",text:"Odpowiedziano na e-mail."},{id:"opt-downloaded",text:"Pobrano plik."},{id:"opt-opened",text:"Otworzono załącznik."},{id:"opt-visited",text:"Odwiedzono link."},{id:"opt-password",text:"Wprowadzono swoje hasło."},{id:"opt-forwarded",text:"Przesłano dalej ten e-mail."},{id:"opt-none",text:"Nie zrobiono nic z e-mailem."}].filter(function(e){var t;return null===(t=document.getElementById(e.id))||void 0===t?void 0:t.checked}).map(function(e){return e.text}),n=t.length?"<ul>".concat(t.map(function(e){return"<li>".concat(escapeXml(e),"</li>")}).join(""),"</ul>"):"<p>Brak zaznaczonych opcji.</p>",o="Zgłoszenie phishing — ".concat(e.subject||""),r="<p>Użytkownik zgłosił podejrzaną wiadomość. Wybrane opcje:</p>".concat(n,"<hr/><p>Oryginalny temat: ").concat(escapeXml(e.subject||"(brak)"),"</p>"),a=e.itemId;try{Office.context.mailbox.convertToEwsId&&(a=Office.context.mailbox.convertToEwsId(e.itemId))}catch(e){}d("Wysyłanie zgłoszenia...",!1),_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,s(a);case 1:return t=e.v,e.n=2,u(t);case 2:showResult(!0,"Dziękujemy — zgłoszenie zostało wysłane.","Twoje zgłoszenie zostało przekazane zespołowi ds. bezpieczeństwa."),e.n=4;break;case 3:e.p=3,n=e.v,console.error("EWS error:",n),showResult(!1,"Błąd wysyłania zgłoszenia","Wystąpił błąd: "+escapeXml(n&&n.message?n.message:JSON.stringify(n)));case 4:return e.a(2)}},e,null,[[0,3]])}))()}else d("Brak aktywnej wiadomości.",!0);function c(e){return new Promise(function(t,n){Office.context.mailbox.makeEwsRequestAsync(e,function(e){e.status===Office.AsyncResultStatus.Succeeded?t(e.value):n(e.error||e)})})}function s(e){return i.apply(this,arguments)}function i(){return(i=_asyncToGenerator(_regenerator().m(function e(t){var n,o,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n='<?xml version="1.0" encoding="utf-8"?>\n      <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                     xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages"\n                     xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types"\n                     xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">\n        <soap:Header>\n          <t:RequestServerVersion Version="Exchange2016" />\n        </soap:Header>\n        <soap:Body>\n          <m:GetItem>\n            <m:ItemShape>\n              <t:BaseShape>IdOnly</t:BaseShape>\n              <t:IncludeMimeContent>true</t:IncludeMimeContent>\n            </m:ItemShape>\n            <m:ItemIds>\n              <t:ItemId Id="'.concat(escapeXml(t),'" />\n            </m:ItemIds>\n          </m:GetItem>\n        </soap:Body>\n      </soap:Envelope>'),e.n=1,c(n);case 1:if(o=e.v,(r=o.match(/<\w*:MimeContent[^>]*>([\s\S]*?)<\/\w*:MimeContent>/i))&&r[1]){e.n=2;break}throw new Error("MimeContent nie znaleziono w odpowiedzi EWS.");case 2:return e.a(2,r[1].trim())}},e)}))).apply(this,arguments)}function u(e){return l.apply(this,arguments)}function l(){return(l=_asyncToGenerator(_regenerator().m(function e(t){var n,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n='<?xml version="1.0" encoding="utf-8"?>\n      <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                     xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages"\n                     xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types"\n                     xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">\n        <soap:Header>\n          <t:RequestServerVersion Version="Exchange2016" />\n        </soap:Header>\n        <soap:Body>\n          <m:CreateItem MessageDisposition="SendAndSaveCopy">\n            <m:SavedItemFolderId>\n              <t:DistinguishedFolderId Id="sentitems" />\n            </m:SavedItemFolderId>\n            <m:Items>\n              <t:Message>\n                <t:Subject>'.concat(escapeXml(o),'</t:Subject>\n                <t:Body BodyType="HTML">').concat(escapeXml(r),"</t:Body>\n                <t:ToRecipients>\n                  <t:Mailbox>\n                    <t:EmailAddress>").concat("soc@wroclaw.sa.gov.pl","</t:EmailAddress>\n                  </t:Mailbox>\n                </t:ToRecipients>\n                <t:Attachments>\n                  <t:FileAttachment>\n                    <t:Name>SuspectedMessage.eml</t:Name>\n                    <t:ContentType>message/rfc822</t:ContentType>\n                    <t:Content>").concat(t,"</t:Content>\n                  </t:FileAttachment>\n                </t:Attachments>\n              </t:Message>\n            </m:Items>\n          </m:CreateItem>\n        </soap:Body>\n      </soap:Envelope>"),e.n=1,c(n);case 1:return a=e.v,e.a(2,a)}},e)}))).apply(this,arguments)}function d(e,t){var n=document.getElementById("phish-status");n&&(n.textContent=e,n.style.color=t?"#b00020":"#2b7a0b")}}function showResult(e,t,n){var o=document.getElementById("result-title"),r=document.getElementById("result-message"),a=document.getElementById("result-icon"),c=document.getElementById("result-again");o&&(o.textContent=t),r&&(r.innerHTML=n),a&&(a.classList.remove("success","error"),a.classList.add(e?"success":"error")),c&&c.classList.toggle("hidden",e),["panel-select","panel-report","panel-result"].forEach(function(e){var t=document.getElementById(e);t&&("panel-result"===e?t.classList.remove("hidden"):t.classList.add("hidden"))})}function escapeXml(e){return e?e.replace(/[<>&'"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"}[e]}):""}Office.onReady(function(e){try{if(e.host===Office.HostType.Outlook){var t=function(e){["panel-select","panel-report","panel-result"].forEach(function(t){var n=document.getElementById(t);n&&(t===e?n.classList.remove("hidden"):n.classList.add("hidden"))})},n=document.getElementById("app-body");n&&(n.style.display="block");var o=Office.context.mailbox.item,r=document.getElementById("item-subject");r&&(r.textContent=o&&o.subject?o.subject:"(brak tematu)");var a=document.getElementById("runSendPost"),c=(document.getElementById("panel-select"),document.getElementById("panel-report"),document.getElementById("panel-result"),document.getElementById("report-phish")),s=document.getElementById("btn-back"),i=document.getElementById("result-close"),u=document.getElementById("result-again");a&&(a.addEventListener("click",function(){return t("panel-report")}),a.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t("panel-report"))})),c&&c.addEventListener("click",function(){sendPhishingReport()}),s&&s.addEventListener("click",function(){return t("panel-select")}),i&&i.addEventListener("click",function(){return t("panel-select")}),u&&u.addEventListener("click",function(){t("panel-report"),document.querySelectorAll("#panel-report input[type='checkbox']").forEach(function(e){return e.checked=!1});var e=document.getElementById("phish-status");e&&(e.textContent="")}),t("panel-select")}}catch(e){console.error("Office.onReady handler error:",e)}});